<!DOCTYPE html>
{% block html %}
<html lang="en">
{% endblock %}
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Copernicus</title>

        <link rel="stylesheet" href="{{ url_for('static', filename='css/uikit.gradient.min.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', filename='css/notify.gradient.min.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', filename='css/progress.gradient.min.css') }}" />

        <script src="{{ url_for('static', filename='js/jquery-1.12.4.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/uikit.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/notify.js') }}"></script>

        {% if current_user.login and "admin" in current_user.permissions() %}
        <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
        <script>
            $(document).ready(function() {
                $('.js-example-basic-single').select2();
            });
        </script>
        {% endif %}


        {% block head %}
        {% endblock %}
    </head>

    {% block body_replace %}
    <body>
    {% endblock %}

    {% block body %}
        {% set item = self | menu_item %}
        {% if current_user.login %}
            {% set menu = True %}
            {% set roles = current_user.permissions() %}
            {% if ["user"] == roles %}
                {% set user = False %}
                {% set responsible = False %}
                {% set committee = False %}
                {% set admin = False %}
            {% else %}
                {% if "user" in roles %}
                    {% set user = True %}
                {% endif %}
                {% if "responsible" in roles %}
                    {% set responsible = True %}
                {% endif %}
                {% if "committee" in roles %}
                    {% set committee = True %}
                {% endif %}
                {% if "admin" in roles %}
                    {% set admin = True %}
                {% endif %}
            {% endif %}
        {% endif %}

        {% if menu %}
            <nav class="uk-navbar uk-navbar-attached uk-margin-bottom">
                <div class="uk-navbar-content uk-display-inline uk-hidden-small">Login: {{current_user.login}}</div>
                <div class="uk-navbar-content uk-display-inline uk-margin-small-left uk-hidden-medium uk-hidden-small">Last update: {{g.timestamp}}</div>
                <ul class="uk-navbar-nav uk-hidden-small">
                    {% if user %}
                        <li {% if item == 'user' %}class="uk-active"{% endif %}><a href="user.html">User</a></li>
                    {% endif %}
                    {% if responsible %}
                        <li {% if item == 'project' %}class="uk-active"{% endif %}><a href="project.html">Project</a></li>
                    {% endif %}
                    {% if committee %}
                        <li {% if item == 'board' %}class="uk-active"{% endif %}><a href="board.html">Board</a></li>
                    {% endif %}
                    {% if admin %}
                        <li {% if item == 'admin' %}class="uk-active"{% endif %}><a href="admin.html">Admin</a></li>
                    {% endif %}
                </ul>

                <a href="#mobile_menu" class="uk-navbar-toggle uk-visible-small" data-uk-offcanvas></a>

                <div class="uk-navbar-flip">
                    {% if admin  and g.user_list %}
                        <form class="uk-search uk-navbar-content uk-hidden-small" action="admin/switch_user" method="POST">
                            <select class="js-example-basic-single" name="switch_user" data-placeholder="Select a user" onchange="this.form.submit()">
                                {% for user in g.user_list %}
                                    <option value="{{user}}" {%if user==current_user.login%}selected{%endif%}>{{user}}</option>
                                {% endfor %}
                            </select>
                        </form>
                    {% endif %}
                    <ul class="uk-navbar-nav">
                        <li>
                            <a href="logout">
                                <span class="uk-icon-sign-out"></span>Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        {% endif %}

        <div class="uk-container uk-container-center uk-grid">

            {% for message in get_flashed_messages() %}
                <div class="uk-alert uk-alert-danger uk-width-1-1" data-uk-alert>
                    <a href="" class="uk-alert-close uk-close"></a>
                    {{message}}
                </div>
            {% endfor %}

            {% block main %}
            {% endblock %}
        </div>

        {% if menu %}
            <div id="mobile_menu" class="uk-offcanvas">
                <div class="uk-offcanvas-bar">
                    <div class="uk-panel">Login: {{current_user.login}}</div>
                    <div class="uk-panel">Last update: {{g.timestamp}}</div>
                    <ul class="uk-nav uk-nav-offcanvas">
                        {% if user %}
                            <li {% if item == 'user' or item == 'index' %}class="uk-active"{% endif %}><a href="user.html">User</a></li>
                        {% endif %}
                        {% if responsible %}
                            <li {% if item == 'project.html' %}class="uk-active"{% endif %}><a href="project.html">Project</a></li>
                        {% endif %}
                        {% if committee %}
                            <li {% if item == 'board.html' %}class="uk-active"{% endif %}><a href="board.html">Board</a></li>
                        {% endif %}
                        {% if admin %}
                            <li {% if item == 'admin.html' %}class="uk-active"{% endif %}><a href="admin.html">Admin</a></li>
                        {% endif %}
                    </ul>
                    <div class="uk-panel">
                        {% if admin  and g.user_list %}
                            <form action="admin/switch_user" method="POST">
                                <select class="js-example-basic-single" name="switch_user" data-placeholder="Select a user" onchange="this.form.submit()">
                                    {% for user in g.user_list %}
                                        <option value="{{user}}" {%if user==current_user.login%}selected{%endif%}>{{user}}</option>
                                    {% endfor %}
                                </select>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}

    {% endblock %}

    </body>
</html>