{% extends "base.html" %}
{% block head %}
    <script defer type="text/javascript" src="../lib/moment-with-locales.js"></script>
    <script defer type="text/javascript" src="../lib/project_new.js"></script>
    <script type="text/javascript" src="../lib/jquery-1.12.3.min.js"></script>
{% endblock %}
{% block main %}
    {% if data.projects %}
        <div class="uk-container uk-container-center uk-grid">
        {% for project in data.projects|sort(attribute='name') %}
            <div class="uk-panel uk-width-1-1 uk-panel-divider">
                <h3 class="uk-panel-title">{{project.title}}</h3>
            </div>
            <div class="uk-width-medium-2-5">
                <div class="uk-panel uk-margin-top uk-margin-bottom">
                    <div>Name: <b>{{project.name}}</b></div>
                    <div>Status: <b>{% if project.active %}Active{% else %}Postponed{% endif %}</b></div>
                    <div>CPU consumed: {{project.consumption}} out of {{project.resources.cpu}} ({{project.usage}})
                        {% set usage = project.usage[0:-1]|int %}
                        {% set total = project.resources.cpu %}
                        {% if total > 0 %}
                            {% if usage > total %}
                                {% set color = "#da314b" %}
                                {% set style = "uk-progress-danger" %}
                            {% elif usage > 60 %}
                                {% set color = "#faa732" %}
                                {% set style = "uk-progress-warning" %}
                            {% elif usage < 10 %}
                                {% set color = "#8cc14c" %}
                                {% set style = "uk-progress-success" %}
                            {% else %}
                                {% set color = "#00a8e6" %}
                                {% set style = "uk-progress-info" %}
                            {% endif %}
                        {% endif %}
                        <div class="uk-progress uk-progress-mini uk-progress-striped {{style}} uk-margin-small-top">
                            <div class="uk-progress-bar" style="width: {{usage}}%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="uk-width-medium-2-5">
                <div class="uk-panel uk-margin-top uk-margin-bottom" id="project_users">
                {% for user in project.users|sort(attribute='fullname')%}
                    <div class="uk-panel" id="{{project.name}}_{{user.login}}">
                    {% if user.login != project.responsible_login %}
                        <button class="uk-button uk-button-mini uk-button-link uk-text-danger remove uk-icon-justify"
                        type="button" data-pid='{{project.id}}'
                        data-name='{{user.fullname}}' data-login='{{user.login}}'
                        data-project='{{project.name}}'>
                        <span class="uk-icon-close"></span>
                        </button>
                    {% else %}
                        <button class="uk-button uk-button-mini uk-button-link uk-icon-justify"
                        type="button" data-pid='{{project.id}}'
                        data-name='{{user.fullname}}' data-login='{{user.login}}'
                        data-project='{{project.name}}' disabled>
                        </button>
                    {% endif %}
                    <span class="uk-margin-small-left">
                    {{user.fullname}}: {{user.consumption}}
                    </span>
                    </div>
                {% endfor %}
                </div>
            </div>
            <div class="uk-width-1-5">
                <div class="uk-panel uk-margin-top uk-margin-bottom">
                    {% if project.active %}
                        {% if project.type=='a' %}
                            <button class="uk-button uk-width-1-1 extend uk-margin-small-bottom" data-project='{{project.id}}' data-name='{{project.name}}' type="button">Transform</button>
                        {% else %}
                            <button class="uk-button uk-width-1-1 extend uk-margin-small-bottom" data-project='{{project.id}}' data-name='{{project.name}}' type="button">Extend&nbsp;project</button>
                        {% endif %}
                        <button class="uk-button uk-width-1-1 history uk-margin-small-bottom" data-project='{{project.id}}' data-name='{{project.name}}' type="button">History</button>
                    {% else %}
                        <button class="uk-button uk-width-1-1 react uk-margin-small-bottom" data-project='{{project.id}}' data-name='{{project.name}}' type="button">Activate project</button>
                    {% endif %}
                </div>
            </div>
            <div class="uk-panel uk-width-1-1">
                <ul class="uk-subnav uk-subnav-pill" data-uk-switcher="{connect:'#{{project.name}}-additional-info'}">
                    <li class="uk-active"><a href="">Description</a></li>
                    <li><a href="">Scientific fields</a></li>
                    <li><a href="">Genci</a></li>
                    <li><a href="">Methods</a></li>
                    <li><a href="">Resources</a></li>
                    <li><a href="">Management</a></li>
                    <li><a href="">Motivation</a></li>
                </ul>
                <ul id="{{project.name}}-additional-info" class="uk-switcher">
                    <li><article>{{project.description}}</article></li>
                    <li><article>{{project.scientific_fields}}</article></li>
                    <li><article>{{project.genci_committee}}</article></li>
                    <li><article>{{project.numerical_methods}}</article></li>
                    <li><article>{{project.computing_resources}}</article></li>
                    <li><article>{{project.project_management}}</article></li>
                    <li><article>{{project.project_motivation}}</article></li>
                </ul>
            </div>
        {% endfor %}
        </div>
    {% endif %}
{% endblock %}